  
# 数仓建模理论与实践

## 数仓建模理论

### 1. 维度建模理论（Dimensional Modeling）
- **星型模型（Star Schema）**：以事实表为中心，周围连接维度表
- **雪花模型（Snowflake Schema）**：维度表进一步规范化，形成层次结构
- **星座模型（Galaxy Schema）**：多个事实表共享维度表

### 2. 范式建模理论（Normalized Modeling）
- **第一范式（1NF）**：消除重复组
- **第二范式（2NF）**：消除部分函数依赖
- **第三范式（3NF）**：消除传递函数依赖
- **BCNF范式**：更严格的第三范式

### 3. Data Vault建模
- **Hub表**：存储业务键
- **Link表**：存储关系
- **Satellite表**：存储描述性数据

### 4. Anchor建模
- **Anchor**：不变的业务概念
- **Attribute**：描述性信息
- **Tie**：关系连接

## 数仓分层架构

### 经典分层模式

#### 1. ODS层（Operational Data Store）
- **作用**：原始数据存储层
- **特点**：
  - 数据格式与源系统保持一致
  - 最小化数据转换
  - 保留历史数据
- **表命名**：`ods_系统名_表名`

#### 2. DWD层（Data Warehouse Detail）
- **作用**：明细数据层
- **特点**：
  - 数据清洗和标准化
  - 统一数据格式
  - 建立一致性维度
- **表命名**：`dwd_主题域_表名`

#### 3. DWS层（Data Warehouse Summary）
- **作用**：汇总数据层
- **特点**：
  - 轻度汇总
  - 按业务主题组织
  - 提高查询性能
- **表命名**：`dws_主题域_表名`

#### 4. ADS层（Application Data Service）
- **作用**：应用数据服务层
- **特点**：
  - 面向具体应用场景
  - 高度聚合的指标数据
  - 直接支撑业务应用
- **表命名**：`ads_应用场景_表名`

### 现代分层模式

#### 1. Bronze层（原始数据层）
- 对应传统ODS层
- 存储原始、未处理的数据

#### 2. Silver层（清洗数据层）
- 对应传统DWD层
- 清洗、验证、去重后的数据

#### 3. Gold层（业务数据层）
- 对应传统DWS/ADS层
- 业务就绪的聚合数据

## 表命名规范

### 1. 基本命名原则
- **小写字母**：统一使用小写
- **下划线分隔**：单词间用下划线连接
- **有意义的名称**：表达清晰的业务含义
- **避免保留字**：不使用数据库保留关键字

### 2. 分层命名规范

#### ODS层命名
```
ods_{源系统}_{业务域}_{表名}
例：ods_erp_sales_order
```

#### DWD层命名
```
dwd_{业务域}_{表名}_{表类型}
例：dwd_trade_order_detail_di  # di表示增量
    dwd_user_info_df          # df表示全量
```

#### DWS层命名
```
dws_{业务域}_{统计粒度}_{业务过程}_{统计周期}
例：dws_trade_user_order_1d   # 用户订单日汇总
    dws_traffic_page_visit_1d # 页面访问日汇总
```

#### ADS层命名
```
ads_{应用场景}_{指标含义}
例：ads_dashboard_trade_stats  # 交易大盘统计
    ads_report_user_retention # 用户留存报表
```

### 3. 维度表命名
```
dim_{维度名称}
例：dim_user_info     # 用户维度表
    dim_product_info  # 商品维度表
    dim_date         # 日期维度表
```

### 4. 事实表命名
```
fact_{业务过程}
例：fact_order_detail  # 订单明细事实表
    fact_payment      # 支付事实表
```

### 5. 临时表命名
```
tmp_{业务含义}_{日期}
例：tmp_user_analysis_20231201
```

### 6. 字段命名规范
- **主键**：通常以`id`结尾，如`user_id`、`order_id`
- **外键**：与关联表主键保持一致
- **时间字段**：
  - `create_time`：创建时间
  - `update_time`：更新时间
  - `etl_time`：ETL处理时间
- **状态字段**：`status`、`state`
- **标识字段**：`is_`开头，如`is_deleted`、`is_active`

### 7. 特殊后缀含义
- **_di**：增量表（Delta/Incremental）
- **_df**：全量表（Delta/Full）
- **_tmp**：临时表
- **_bak**：备份表
- **_his**：历史表


### 8. 事实表和维度表的命名规范解析

**事实表和维度表通常属于DWD层**，但在命名上有不同的约定方式。
虽然事实表和维度表确实属于DWD层，但使用 `fact_` 和 `dim_` 前缀是主流的做法，因为：
- 符合行业标准和历史惯例
- 语义更清晰，便于识别表类型
- 避免命名冗余，提高可读性

### 推荐做法
```sql
-- DWD层结构
├── 事实表
│   ├── fact_order_detail
│   ├── fact_payment
│   └── fact_user_behavior
├── 维度表
│   ├── dim_user_info
│   ├── dim_product_info
│   └── dim_date
└── 其他明细表
    ├── dwd_trade_order_detail_di
    └── dwd_user_login_log_di
```


## 为什么混合命名方式？

### 1. **历史传统和行业惯例**
- 维度建模理论（Kimball方法论）中就是使用 `fact_` 和 `dim_` 前缀
- 大多数数据仓库工具和文档都遵循这个约定
- 业界标准做法，便于团队协作和知识传承

### 2. **语义清晰性**
- `fact_` 和 `dim_` 直接表达了表的建模类型
- 比 `dwd_fact_` 更简洁，避免冗余
- 一眼就能识别是事实表还是维度表

### 3. **跨层复用**
- 维度表可能被多个层级引用（DWD、DWS、ADS）
- 使用 `dim_` 前缀不绑定特定层级
- 便于维度表的统一管理

### 总结混合命名的原因
- **事实表/维度表**：使用 `fact_`/`dim_` 强调建模类型
- **其他明细表**：使用 `dwd_` 强调数仓层级
- 这样既保持了建模的语义清晰，又体现了分层架构

